import { WAMessageStubType } from '@whiskeysockets/baileys'

const handler = async (m, { conn, participants, groupMetadata }) => {
  // Configuration
  const BANNED_BOTS = [
    '2347035629445@s.whatsapp.net', // Example bot number
    '987654321@s.whatsapp.net'  // Add more bot numbers here
  ]
  
  const DELETE_ALL_NON_ADMINS = false // Set true to delete all non-admin messages
  const DELETE_ALL_MEDIA = true       // Delete all media messages
  const LOG_ACTIONS = true            // Log deletions in console

  try {
    // Skip if not a group
    if (!m.isGroup) return
    
    // Get sender info
    const sender = m.key.participant || m.key.remoteJid
    const isAdmin = groupMetadata.participants.find(p => p.id === sender)?.admin
    
    // Skip if message is from admin when in strict mode
    if (isAdmin && !DELETE_ALL_NON_ADMINS) return
    
    // Check if sender is a banned bot
    const isBannedBot = BANNED_BOTS.includes(sender)
    
    // Check conditions for deletion
    const shouldDelete = 
      DELETE_ALL_NON_ADMINS && !isAdmin ||  // Delete all non-admin messages
      isBannedBot ||                        // Delete banned bots
      (DELETE_ALL_MEDIA && (m.message?.imageMessage || m.message?.videoMessage)) // Delete media
    
    if (shouldDelete) {
      // Delete the message
      await conn.sendMessage(m.chat, {
        delete: {
          id: m.key.id,
          participant: sender,
          remoteJid: m.chat,
          fromMe: false
        }
      })
      
      // Optional: Ban the user
      // await conn.groupParticipantsUpdate(m.chat, [sender], 'remove')
      
      if (LOG_ACTIONS) {
        console.log(`Deleted message from ${sender} in ${m.chat}`)
      }
    }
    
  } catch (error) {
    console.error('AntiBot Error:', error)
  }
}

// Listen to all messages
handler.all = true

// Only process messages that aren't from the bot itself
handler.before = (m) => !m.isBaileys

// Run before other handlers
handler.priority = 50 

handler.help = ['antibot']
handler.tags = ['group']
handler.command = ['antibot']
handler.admin = true
handler.group = true

export default handler